<html>
<head>
   
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/3.0.1/mustache.js"></script>
    <link rel="stylesheet" href="css/style.css">

</head>
<body>
    
    <input id="typing" type="text" onkeypress="maybefetch(event)">
    <input type="file" id="img_upload" multiple>
    <button id="upload_button" onclick="maybesend(event)">Upload</button>
    <script src="js/imager.js"></script>
    <script>
        var body = document.querySelector("body");

        function ajax_get(url, callback) {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    try {
                        var data = JSON.parse(xhr.responseText);
                        callback(data);
                    } catch(err) {
                        console.log(err.message + " in " + xhr.responseText);
                    }
                }
            }
            xhr.open("GET", url, true);
            xhr.send();
        }

        function filesend(files, url, callback) {
            var formData = new FormData();
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    try {
                        callback();
                    } catch(err) {
                        console.log(err.message + " in " + xhr.responseText);
                    }
                }
            }
            for (var i = 0; i < files.length; i++) {
                formData.append('files[]', files[i]);
            }
            var qi = prompt("key");
            formData.append("qi", qi);
            xhr.open('POST', url);
            xhr.send(formData);
        }

        function maybefetch(event) {
            if (event.keyCode == 13) {
                ajax_get("images/" + document.getElementById("typing").value, (urllist) => load_imgs_from_src(urllist, body));
            }
        }

        function maybesend(event) {
            filesend(document.getElementById('img_upload').files, "images/" + document.getElementById("typing").value, () => maybefetch(event));
        }



    </script>

</body>
</html>
